name: Remote Android GUI
on: 
  workflow_dispatch:
    inputs:
      ngrok_token:
        description: 'Your Ngrok Authtoken'
        required: true

jobs:
  android:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Install Ngrok
        run: brew install ngrok/ngrok/ngrok

      - name: Run Android Emulator
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 28 # API 28 is much more stable on GitHub than 29/30
          target: google_apis
          arch: x86_64
          # SWIFTSHADER is the keyâ€”it forces the CPU to do the graphics work
          # so it doesn't wait for a GPU that isn't there.
          emulator-options: -no-window -gpu swiftshader_indirect -no-audio -no-boot-anim -qemu -vnc :0
          disable-animations: true
          # We increase the timeout to 15 mins (900s) just in case
          emulator-boot-timeout: 900
          script: |
            echo "Emulator is alive! Setting up tunnel..."
            ngrok config add-authtoken ${{ github.event.inputs.ngrok_token }}
            
            # Start tunnel for VNC (port 5900)
            ngrok tcp 5900 --log=stdout &
            
            # This keeps the session open for you to use
            sleep 3600
