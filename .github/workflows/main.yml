name: Windows Remote Control (Cloudflare)
on: workflow_dispatch

jobs:
  remote_control:
    runs-on: windows-latest
    steps:
      - name: Install Control Tools
        run: |
          # TightVNC for the desktop server, Cloudflared for the tunnel
          choco install tightvnc cloudflared -y
        shell: powershell

      - name: Set VNC Password
        run: |
          # Set a default password 'remote' for the connection
          $pass = "remote"
          Start-Process "C:\Program Files\TightVNC\tvnserver.exe" -ArgumentList "-install" -Wait
          Start-Process "C:\Program Files\TightVNC\tvnserver.exe" -ArgumentList "-controlservice -setpassword=$pass" -Wait
          Start-Process "C:\Program Files\TightVNC\tvnserver.exe" -ArgumentList "-controlservice -setviewonlypassword=$pass" -Wait
          net start "TightVNC Server"
        shell: powershell

      - name: Start Cloudflare Tunnel
        shell: powershell
        run: |
          # This creates a public 'TryCloudflare' link for the VNC port (5900)
          # No account or token needed for this quick setup
          Start-Process cloudflared -ArgumentList "tunnel --url tcp://localhost:5900" -NoNewWindow
          Start-Sleep -Seconds 20
          
          # Find the URL in the logs
          Write-Host "--- CHECK LOGS BELOW FOR YOUR TUNNEL URL ---"
          Get-Content "$env:USERPROFILE\.cloudflared\*.log" -ErrorAction SilentlyContinue | Select-String "trycloudflare.com"
