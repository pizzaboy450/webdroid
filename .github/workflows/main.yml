name: RDP
on:
  workflow_dispatch:

jobs:
  windows-browser:
    runs-on: windows-latest
    steps:
      - name: Setup VNC & noVNC
        run: |
          choco install tightvnc -y
          & "C:\Program Files\TightVNC\tvnserver.exe" -install
          & "C:\Program Files\TightVNC\tvnserver.exe" -controlapp -setpassword "cloud123"
          net start "TightVNC Server"
          npm install -g novnc

      - name: Start Web Bridge
        shell: pwsh
        run: |
          # Start noVNC in the background
          Start-Process powershell -ArgumentList "-NoProfile -Command & {novnc --vnc localhost:5900 --listen 8080}"
          
          # Wait until port 8080 is actually open
          Write-Host "Waiting for port 8080..."
          while (!(Test-NetConnection localhost -Port 8080).TcpTestSucceeded) { Start-Sleep -Seconds 2 }
          Write-Host "Port 8080 is READY."

      - name: Launch Bore Tunnel
        shell: pwsh
        run: |
          # Download Bore (Single binary, no install, no 502s)
          Invoke-WebRequest -Uri "https://github.com/ekzhang/bore/releases/download/v0.5.1/bore-v0.5.1-x86_64-pc-windows-msvc.zip" -OutFile "bore.zip"
          Expand-Archive bore.zip -DestinationPath .
          
          Write-Host "--- YOUR CONNECTION INFO ---"
          # This connects your local 8080 to a public Bore server
          ./bore.exe local 8080 --to bore.pub
