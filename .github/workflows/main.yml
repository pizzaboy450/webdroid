name: RDP
on:
  workflow_dispatch:

jobs:
  rdp-browser:
    runs-on: windows-latest
    steps:
      - name: Setup VNC & noVNC
        run: |
          # 1. Install VNC but don't touch the user accounts
          choco install tightvnc -y
          & "C:\Program Files\TightVNC\tvnserver.exe" -install
          & "C:\Program Files\TightVNC\tvnserver.exe" -controlapp -setpassword "cloud123"
          net start "TightVNC Server"
          npm install -g novnc

      - name: Launch Web Desktop
        shell: pwsh
        run: |
          # 2. Start the bridge
          Start-Process powershell -ArgumentList "-NoProfile -Command & {novnc --vnc localhost:5900 --listen 8080}"
          
          # 3. Use the built-in GitHub Tunnel (Code-Server)
          # This is the most popular way to bypass all 502/503 errors
          Invoke-WebRequest -Uri "https://code.visualstudio.com/sha/download?build=stable&os=win32-x64-archive" -OutFile "vscode.zip"
          Expand-Archive vscode.zip -DestinationPath .
          
          Write-Host "--- LOGIN TO GITHUB BELOW ---"
          ./bin/code.exe tunnel --accept-server-license-terms --name gh-desktop
