name: Community Browser RDP
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Preparing Environment
        run: |
          # This part is from the popular 'RDP-Next' scripts
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
          net user runneradmin CloudPass2025! /add
          net localgroup Administrators runneradmin /add

      - name: Install noVNC & Tunnel
        run: |
          # Most popular scripts use Choco for speed and reliability
          choco install tightvnc -y
          npm install -g novnc
          
          # This is the "Magic" step from the top-rated scripts:
          # It starts a portable 'Websockify' bridge
          Start-Process powershell -ArgumentList "-NoProfile -Command & {novnc --vnc localhost:5900 --listen 8080}"
          
      - name: Connect to Tunnel
        shell: pwsh
        run: |
          # Instead of Ngrok or Cloudflare, popular scripts now use 'LocalXpose' 
          # It is currently the most popular 'non-Cloudflare' tunnel for GitHub
          Invoke-WebRequest https://loclx.io/download/windows/loclx-windows-amd64.zip -OutFile loclx.zip
          Expand-Archive loclx.zip -DestinationPath .
          
          Write-Host "--- OPEN THIS LINK IN YOUR BROWSER ---"
          ./loclx.exe tunnel http --port 8080
